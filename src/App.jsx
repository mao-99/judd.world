import { useState, useEffect } from 'react'
import { createClient } from '@supabase/supabase-js'
import { BrowserRouter as Router, Route, Routes } from 'react-router-dom';
import Home from './components/home';
import SideNav from './components/sideNav';
import SimpleLookup from './components/simpleLookup';
import SimpleLookupResult from './components/simpleLookupResult';
import Averages from './components/averages';
import Plot from './components/plot';
import './App.css'

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseKey = import.meta.env.VITE_SUPABASE_ANON_KEY;
export const supabase = createClient(supabaseUrl, supabaseKey);

function App() {
  const [data, setData] = useState([]);
  let myCrimes = ["CRIM POSS CONTR SUBSTANCE","CRIM SALE CONTR SUBSTANCE","MAKE TERRORISTIC TH","ASSAULT","MANSLAUGHTER","ATT CRIM POSS WEAP","ATT BURGLARY","ATT RAPE","BURGLARY","ATT ROBBERY","ROBBERY","ATT MURDER","CRIM POSS WEAP","MURDER","CRIM POSS STOLEN PROP","ATT ASSAULT","CRIM POSS WEAP 3RD SUB 4-8","ATT CRIM SALE CONTR SUBSTANCE","ATT CRIM POSS WEAP 3RD SUB 4-8","CRIM POSS CONTR SUBSTANCE","KIDNAPPING","ATT CRIM POSS STOLEN PROP","GRAND LARCENY - AUTO","ATT CRIM POSS CONTR SUBSTANCE","ATT CRIM POSS WEAP 3RD SUB 1","CONSPIRACY","AGGRAVATED VEHICULAR HOMI","AGGRAVATED VEHICULAR ASS","AGGRAVATED FAMILY OFF","COURSE SEX CONDUCT-CHILD","CRIM SEXUAL ACT","RAPE","SEXUAL ABUSE","ROBBERY 2ND SUB","GRAND LARCENY - NOT AUTO","ATT GRAND LARCENY - AUTO","ATT ROBBERY 2ND S","CRIM POSS WEAP 3RD SUB 1","FORGERY","ATT STRANGULATION","SEX OFF REG VIOL-2ND OFF","CRIM CONTEMPT","DWI:ALCOHOL/DRUGS-2ND OFF","SODOMY","ATT ARSON","RECKLESS ENDANGERMENT","CRIM MISCHIEF","ATT PROM PRISON CONTRABAND","CRIM POSS MARIHUANA","AGG DWI:W/C","AGG UNLIC OPER MV","UNLAW IMPRISONMENT","UNAUTH USE OF MV","BAIL JUMPING","INSURANCE FRAUD","FRAUDULENT PRACT","CRIM POSS DANGEROUS DRUG","CRIM NEGLIGENT HOMI","ABSCOND FROM TEMP RELEASE","SEX OFF REG VIOL-1ST OFF","IDENTITY THEFT","CRIM POSS FORGED INST","SCHEME TO DEFRAUD","CRIM POSS FIR","CRIM SALE CONTR SUBS - SC","PROM PROSTITUTION","MONEY LAUNDERING","ATT GRAND LARCENY - NOT AUTO","ATT CRIM SEXUAL ACT","ATT DISSEM INDECENT MAT MINOR","AGGRAVATED CRIM CONT","ATT ROBBERY 2ND SUB","JO - MANSLAUGHTER","LV SCENE OF ACCIDENT - D","ATT BURGLARY 2ND S","STRANGULATION","COERCION","CRIM USE OF FIREARMS","PROM PRISON CONTRABAND","BRIBERY","ARSON","TAMPER WITH A WITNESS","ENTERPRISE CORRUP","ATT MANSLAUGHTER","AGG HAR:EMPLOYEE BY IN","VEHICULAR MANSLAUGHTER","BURGLARY 2ND S","ROBBERY 2ND S","JO - ROBBERY","PERSISTENT SEXUAL A","AGGRAVATED SEXUAL ABUSE","PROM SEXUAL PERF BY A C","VEHICULAR ASSAULT","ATT FORGERY","DRIV IMP/DRUGS - 3RD OFF","IN","ATT BRIBERY","CRIM SALE DANGEROUS DRUG","TAMPER WITH PHYS EVID","GANG ASSAULT","ATT CRIM POSS FORGED INST","CRIM SALE MARIHUANA","ATT SODOMY","POSS A SEX PERF BY A C","JO - MURDER","CRIM IMPERSONATION","ATT SEXUAL ABUSE","DWI:ALCOHOL/DRUGS-3RD OFF","ESCAPE","ATT COURSE SEX CONDUCT-CHILD","LV SCENE OF ACC W/O REPOR","CRIM SALE FIREARM","ATT BAIL JUMPING","PRED SEX ASSAULT AGAINST C","ATT CRIM POSS MARIHUANA","ASSAULT 1ST (HATE CR","ATT CRIM SALE CONTR SUBS - SC","ATT KIDNAPPING","ATT GANG ASSAULT","ANIMAL FIGH","ATT OPERATE MAJOR DRUG TRAFFI","PERJURY","CRIM SALE FIREARMS","SEX TRAFFIC","ATT PROM PROSTITUTION","HINDERING PROSECUTION","CONCEALMENT OF A HUMAN CO","ATT PERJURY","ATT CONSPIRACY","AGG DWI:1 PRIOR CONV-10","ATT AGGRAVATED ASSAULT/PEACE ","FALSIFY BUSINESS RECORDS","ATT COERCION","ATT CRIM SALE MARIHUANA","UNLAW MANUFACTURE METH","BRIBING A WIT","UNSPECIFIED FE","AUTO STRIPPING","ATT AGGRAVATED CRIM CONT","ATT CRIM POSS DANGEROUS DRUG","DRIV IMP/DRUGS-2ND OFF","STALKING 1ST S","OFFER FALSE INST FILING","SEX TRAFFICKING SUB 5A","HEALTH CARE FRAUD","MED ASSIST PROV PROH PRACT","CRIM POSS FORGERY DEV","ATT JO - MURDER","ASSAULT 3RD (HATE CR","COMPUTER TAMPERING","AGG DWI:2 PRIOR CONV-10","CRIM POSS PRECURSORS OF ","OPERATE MAJOR DRUG TRAFFI","ASSAULT 2ND (HATE CR","INCEST","RIOT","INTIMIDATE VICTIM/WITNESS","MURDER (DEG LESS PRIOR 9-1","ATT RECKLESS ENDANGERMENT","PROM GAMB BOOKMAKING","ATT USE OF DRUG PARAPHERNALIA","PETIT LAR","ATT USE OF CHILD IN A SEXUAL ","UNLAW SURVEILLANCE 2ND(2","CRIME IS NOT A FE","PREDATORY SEXUAL ASS","CIG TAX-POSS/TRANS>20K ILL","ATT AGGRAVATED SEXUAL ABUSE","ATT ROBBERY 3RD (HATE CR","ILLEGAL POSS VEH ID NO P","ATT ENTERPRISE CORRUP","ATT CRIM MISCHIEF","USE OF DRUG PARAPHERNALIA","USE OF CHILD IN A SEXUAL ","CRIM POSS HYPO INSTRU","ATT UNSPECIFIED FE","ROBBERY 1ST (HATE CR","ATT ESCAPE","CRIM POSS WEAPON SCHOOL ","AGGRAVATED IDENTITY T","CRIM TAMPERING","POSS OBSCENE SEX PERF BY C","JO - BURGLARY","JO - ASSAULT","CRIM POSS METH MANUF MATER","ASLT:POLICE OFF/FIREMAN","ROBBERY 1ST (PRIOR 9/1","ATT INTIMIDATE VICTIM/WITNESS","ATT CRIM FACILITATION","AGGRAVATED HARASSMENT","CRIM INJECT OF A NARC ","MENACING POLICE/PEACE OFF","WELFARE FRAUD","UNLAW POSS PERSONAL ID","FLEE OFFICER IN MOTOR VEH","CRIM FACILITATION","ATT IDENTITY THEFT","ATT MURDER (DEG LESS PRIOR 9-1","SEXUAL MISCON","CRIM SALE OF FIREARM 3 PR","ATT CRIM SALE FIREARM","CRIMINAL TAX FRAUD","MISUSE FOOD STMP:VALUE>$50","PROM OBSCENE SEX PERF BY C","ATT CRIM SALE DANGEROUS DRUG","UNLAW SURVEILLANCE 2ND S","ATT UNLAW MANUFACTURE METH","ATT CRIM USE OF FIREARMS","UNLAW IMPRISONMENT 2ND (HATE CR","POSS GAMB RCDS LOTT/POLICY","CRIM SOLICITATION","MENACING","MFG/TRANS/ETC DANGEROUS WE","RAPE 1ST (PRIOR 9/1","BRIBE REC","ATT MENACING POLICE/PEACE OFF","TAMPER WITH PUBLIC REC","FACILITATE SEX OFF/CONTROL","CRIM POSS COMP RELATED ","DISSEM INDECENT MAT MINOR","ATT ASSAULT 2ND (HATE CR","CRIM NUISANCE","ATT JO - ROBBERY","JO - CRIM POSS WEAP 2ND SC","SODOMY 1ST (PRIOR 9/1","JO - KIDNAPPING","CRIM TRESPASS","ATT UNAUTH USE OF MV","UNAUTH PRACTICE OF PROFES","CIG TAX-ATT TO EVADE OR DE","POSS/TRANS 10K+ UNSTAMPED ","STALKING","REC REWARD OFF MISCONDUCT","ATT SEX OFF REG VIOL-2ND OFF","ATT PROM SEXUAL PERF BY A C","FALSELY REPORTING INCIDENT","CRIM POSS PRECUR","ENDANGER INCOMPETENT","IMIT CONTROL SUBS-2ND ","ATT ASLT:POLICE OFF/FIREMAN","BRIBE REC BY A WIT","POSS OF BURGLARS T","ATT CRIM TAMPERING","MENACING 2ND (HATE CR","JO - CRIM SEXUAL ACT","POSS DANGEROUS WE","GRAND LARCENY - NOT AUTO 4TH (HATE CR","CONSPIRACY 5TH (HATE CR","ATT PETIT LAR","ATT AGGRAVATED MU","RECKLESS ASSAULT OF A C","JOST","MISUSE FOOD ST","AGGRAVATED ASSAULT/PEACE ","CRIM MISCHIEF 3RD (HATE CR","ATT BRIBING A WIT","UNLAW SURVEILLANCE 2ND(2,","ATT PROM OBSCENE SEX PERF BY C","JO - CRIM POSS WEAP 3RD SC","DWI:ALCOHOL/DRUGS-1ST OFF","ATT PREDATORY SEXUAL ASS","SEX TRAFFICKING OF A C","ATT SEX TRAFFIC","ATT FALSELY REPORTING INCIDENT","ENDANGER VUL/ELDER","CUSTODIAL INTERFERENCE","ATT CRIM POSS FORGERY DEV","EAVESDROP","CORRUPTING THE GOVERNMENT","CONTRACTS FOR MONO","LURING CHILD TO COMMIT A C","MURDER 1ST (HATE CR","ABSCOND COMMUNITY TREAT","JO - RAPE","PATRONIZING A PROSTITUTE","AGG CRIM NEGLIGENT HOMI",",DISSEM INDECENT MAT MINOR","UNLAW DISPOSAL METH LAB","ATT MURDER 2ND (HATE CR","MAKE FALSE REPORT RE STOLE","POSS GAMB RCDS BOOKMAKING","AGGRAVATED MU","JO - SODOMY","LV SCENE OF ACCIDENT - ","BURGLARY 1ST (PRIOR 9/1","ATT AGGRAVATED SEXUAL A","NO CRIME RECORD A","ABORTION",",POSS A SEX PERF BY A C","ATT CRIM POSS HYPO INSTRU","ATT BRIBE REC BY A WIT","TRADEMARK COUNTERFEITING","COMPUTER TRES","ATT STALKING 1ST S","UNLAW WEARING BODY ","PROHIBITED USE OF WEA","AGGRAVATED SEXUAL A","ATT INSURANCE FRAUD","NON-SUPPORT CHILD","ATT RAPE 1ST (PRIOR 9/1","BURGLARY 1ST (HATE CR","BURGLARY 2ND SUB 1 (HATE CR","CRIM PURCHASE/DISPOSAL WE","AGGRAVATED CRIM POSS WE","CRIM USURY","BI","BODY STEA","COMMERCIAL BRIBE REC",",SEXUAL ABUSE","CRIM SALE PRESCRIP","STRANGULATION 2ND (HATE CR","ATT PLACE FALSE BOMB","PLACE FALSE BOMB","ATT CRIM POSS CHEM/BIOL WEAPON","GRAND LARCENY - NOT AUTO 3RD (HATE CR","ATT MAKE TERRORISTIC TH","ABANDONMENT OF C","ATT PROHIBITED USE OF WEA","FORGERY OF VEHICLE ID. NU","MANSLAUGHTER 1ST (HATE CR","AGG DWI:W/CHILD-2ND OFF","ATT INCEST","ATT SEX TRAFFICKING SUB 5A","RESIDENTIAL MORTGAGE FRAUD","ATT HINDERING PROSECUTION","CRIM DIVERSION PRESCRIP","ATT CRIM DIVERSION PRESCRIP","BURGLARY 3RD (HATE CR","ATT STRANGULATION 2ND (HATE CR","CRIM POSS BENEFIT CARD","ATT CRIM SOLICITATION","ATT DWI:ALCOHOL/DRUGS-3RD OFF","BURGLARY 2ND SUB 2 (HATE CR","UNLAW IMPRISONMENT 1ST (HATE CR","ABSCOND FROM FURLOUGH ","ATT ASSAULT 1ST (HATE CR","ATT CRIM SALE OF FIREARM 3 PR","OBSCENITY","ATT LURING CHILD TO COMMIT CLA","ATT ROBBERY 2ND (HATE CR","FRAUD IN SALE OF SECURI","BURGLARY 2ND (HATE CR","POSS SKIMMER DEVICE","AGGRAVATED HARASSMENT 2ND (HATE CR","QRIM POSS DANGEROUS DRUG","ATT WELFARE FRAUD","CRIM SALE CONTR SUBS TO C","LABOR TRAFFIC","PROHIBITED USE OF WEAPONS ","MISCONDUCT BY A J","CRIM POSS CANNABIS","ATT TAMPER WITH A WITNESS","ATT POSS DANGEROUS WE","ATT SEX TRAFFICKING OF A C","ATT MONEY LAUNDERING","ATT CRIM PURCHASE/DISPOSAL WE","FAIL TO FILE INCOME","CONSPIRACY 4TH (HATE CR","FRAUDULENTLY ACCOS","ATT VEHICULAR ASSAULT","ATT BRIBE REC","MANSLAUGHTER 2ND (HATE CR","ATT CRIM SALE CONTR SUBS TO C","ATT ROBBERY 1ST (HATE CR","ATT TAMPER WITH PUBLIC REC","OPENING GR","COMPELLING PROSTITU","ATT CRIM USURY","ATT CRIM TRESPASS","CEMETERY DESECRATION",",TAMPER WITH PHYS EVID","ATT CRIM POSS BENEFIT CARD","JO - ARSON","MURDER 2ND (HATE CR","REWARDING OFF. MISCONDUCT","ENDANGER PUB HLTH/SFTY/ENV","PLACING FALSE ","COMMERCIAL BRIBING","BRIBE REC BY A LABOR OFFI","ATT CRIME IS NOT A FE","MANSLAUGHTER 1ST(PRIOR 9/1","JO - AGG SEXUAL ABUSE","CRIM SALE FIREARM TO A M",",AGG UNLIC OPER MV","ATT PRED SEX ASSAULT AGAINST C","PROM GAMB LOTT/POLICY","REPEAT FAILURE:FILE PERSNL","ATT RECKLESS ASSAULT OF A C","ATT VEHICULAR MANSLAUGHTER","POSS EXPLOSIVES W/O","MAKE APP SWORN FALSE STATE","ROBBERY 2ND SUB 2","3 (HATE CR","CRIM MISCHIEF 4TH (HATE CR","ATT LABOR TRAFFICKING SUB 3A","ATT AUTO STRIPPING","ATT JO - KIDNAPPING","UNLAW SURVEILLANCE","CRIM POSS WEAP 3RD SUB ","CRIM SALE FIREARM/AID OF M","ATT CRIM POSS WEAP 3RD SUB ","LIFE SETTLEMENT FRAUD","ASLT BY OPER OF A VE","ATT ARSON 1ST (HATE CR","ATT FALSIFY BUSINESS RECORDS","GRAND LARCENY - NOT AUTO 2ND (HATE CR","FAIL DISCLOSE ORIGIN REC","UNSPECIFIED MISDEME","SEX MOTV FEL BURGLARY","UNLAWFUL DISSECTION HUMAN ","ATT JO - RAPE","ATT UNLAW SURVEILLANCE",",CRIM MISCHIEF","PLACING FALSE BOMB","FALSE TAX RETURN - PERS","ATT JO - ASSAULT","ATT MURDER 2ND PRE-9/","RAPE 1ST (HATE CR","ATT RECKLESS ENDANGERMENT 1ST (HATE CR","ATT QRIM POSS DANGEROUS DRUG","DISSEM UNLAW SURV IMAGE","DEFRAUDING THE GOVERN","ATT MENACING","ATT ROBBERY 2ND SUB 1 (HATE CR","ATT MFG/TRANS/ETC DANGEROUS WE","ATT AGGRAVATED VEHICULAR ASS","AGGRAVATED MANSLAUGHTER"]
  myCrimes = myCrimes.filter((element, index, self) => {
    return self.indexOf(element) ===index;
  })
  const [allCrimes, setAllCrimes] = useState(myCrimes);
  const [crimesAndDegrees, setCrimesAndDegrees] = useState({});
  useEffect(()=>{
    const loadDatabase = async () => {
      const {data, error} = await supabase.from('convictionData').select('lastName, firstName, sentenceDuration, crimeArray, degreeArray');
      if (error){
        console.error("Mr man, stop there: ", error);
        return;
      }
      return data;
    }
    loadDatabase();
    const call = async () => {
      let dataBase = await loadDatabase();
      setData(dataBase);
      console.log(dataBase)
    }
    call ();
  }, [])

  return (
    <>
      <Router>
        <div className="body">
          <SideNav />
          <Routes>
            <Route path='/' element={<Home/>} />
            <Route path='/simple' element={<SimpleLookup allCrimes={allCrimes} />} />
            <Route path='/simpleResults/:result' element={<SimpleLookupResult />} />
            <Route path='/averages' element={<Averages allCrimes={allCrimes}  crimesAndDegrees={crimesAndDegrees} setCrimesAndDegrees={setCrimesAndDegrees}/>} />
            <Route path='/averages/plot/:filter' element={<Plot crimesAndDegrees={crimesAndDegrees} setCrimesAndDegrees = {crimesAndDegrees} />} />
          </Routes>
        </div>
      </Router>
    </>
  )
}

export default App
